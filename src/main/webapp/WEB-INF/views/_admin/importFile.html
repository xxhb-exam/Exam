<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>上传Excel</title>
    <link href="/static/assets/yeti/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css"/>
    <link rel="stylesheet" href="/static/assets/toastr-master/toastr.css" />
    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
</head>

<body>
<form enctype="multipart/form-data" id="batchUpload"  action="/admin/upload" method="post" class="form-horizontal">
    <button class="btn btn-success btn-xs" id="uploadEventBtn" style="height:26px;"  type="button" >选择文件</button>  
    <input type="file" name="file"  style="width:0px;height:0px;" id="uploadEventFile">  
    <input id="uploadEventPath"  disabled="disabled"  type="text" placeholder="请选择excel表" style="border: 1px solid #e6e6e6; height: 26px;width: 200px;" >
</form>
<!--<button type="button" class="btn btn-success btn-sm"  οnclick="user.uploadBtn()" >上传</button>-->
<button type="button" class="btn btn-success btn-sm"  id = "uploadBtnTest" οnclick="uploadBtn()" >上传</button>
<!--<a id="back" href="#">返回</a>-->
<button class="btn btn-success btn-sm" id="newback">返回</button>


</body>

<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
    var backUri = document.referrer;
    /*$('#back').attr("href",backUri);*/
    $('#newback').click(function(){
        window.location.href=backUri;
    })
</script>
<script charset="utf-8" type="text/javascript" language="javascript">
    var User = function(){
        this.init = function(){

            //模拟上传excel
            $("#uploadEventBtn").unbind("click").bind("click",function(){
                $("#uploadEventFile").click();
            });
            $("#uploadEventFile").bind("change",function(){
                $("#uploadEventPath").attr("value",$("#uploadEventFile").val());
            });

        };

        this.sendAjaxRequest = function(url,type,data){
            $.ajax({
                url : url,
                type : type,
                data : data,
                success : function(result) {
                    alert( result);
                },
                error : function() {
                    alert( "excel上传失败");
                },
                cache : false,
                contentType : false,
                processData : false
            });
        };
    };

    $("#uploadBtnTest").click(function () {
        var uploadEventFile = $("#uploadEventFile").val();
        if(uploadEventFile === ''){

            alert("请选择excel,再上传");
        }else if(uploadEventFile.lastIndexOf(".xls")<0){//可判断以.xls和.xlsx结尾的excel
            alert("只能上传Excel文件");
        }else{
            var url =  '/admin/upload/';
            var formData = new FormData($('form')[0]);
            console.log(formData);
            user.sendAjaxRequest(url,'POST',formData);
        }
    });

    var user;
    $(function(){
        user = new User();
        user.init();
    });
</script>
</html>